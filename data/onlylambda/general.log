====================================================
START@:     Fri May 6 16:14:51 CEST 2016
====================================================
======================= DaVinci script ========================
#---------------------------------------------
# Author   : Bilas Pal
# Date     : 10/26/2012
# Comments : /\b->J/psi p+ K-
# Data     : Real Data
#---------------------------------------------
from Gaudi.Configuration import *
from Configurables import GaudiSequencer
from Configurables import  DecayTreeTuple, CheckPV
from PhysSelPython.Wrappers import AutomaticData, Selection, SelectionSequence, DataOnDemand, MergedSelection
from Configurables import   CombineParticles, FilterDesktop,  OfflineVertexFitter

# #--Stripping--------------------------------------------------------
# from StrippingConf.Configuration import StrippingConf, StrippingStream
# from StrippingSettings.Utils import strippingConfiguration
# from StrippingArchive.Utils import buildStreams
# from StrippingArchive import strippingArchive

# #----------------------Standard stripping20-------------------------
# stripping='stripping20'
# config  = strippingConfiguration(stripping)
# archive = strippingArchive(stripping)
# streams = buildStreams(stripping=config, archive=archive)

# #----Select my line-------------------------------------------------
# MyStream = StrippingStream("MyStream")
# MyLines = [ 'StrippingFullDSTDiMuonJpsi2MuMuDetachedLine' ]

# for stream in streams:
#     for line in stream.lines:
#         if line.name() in MyLines:
#             MyStream.appendLines( [ line ] )

# sc = StrippingConf( HDRLocation = "MyStrip", Streams = [ MyStream ] )
# #------------------------------------------------------------------------

#----selection p+ and K- -------------------------
Lambda0LL = DataOnDemand(Location = "/Event/Phys/StdLooseLambdaLL/Particles")
Lambda0DD = DataOnDemand(Location = "/Event/Phys/StdLooseLambdaDD/Particles")

#----Selection /\->p+ pi-

AllLambda0 = MergedSelection( "AllLambda0", RequiredSelections = [Lambda0LL, Lambda0DD])

_FilterL = FilterDesktop("_FilterL")
_FilterL.Code = "(ADMASS('Lambda0') < 30.*MeV)"\
                  "& (VFASPF(VCHI2/VDOF) < 12.0)"

FilterL = Selection( "FilterL",
                      Algorithm          = _FilterL ,
                      RequiredSelections = [ AllLambda0 ] )

### Gaudi sequence
SeqL = SelectionSequence("SeqL", TopSelection = FilterL)
seq = SeqL.sequence()

#--------------------------------------------------------------------------
# Configure DaVinci
#-------------------------------------------------------------------------
from Configurables import DaVinci

# DaVinci().appendToMainSequence( [sc.sequence() ] )   # Append the stripping selection sequence to DaVinci

from Configurables import  OfflineVertexFitter

from Configurables import  DecayTreeTuple, MCDecayTreeTuple
importOptions("Xb2JpsiXTree.py")


tuple = DecayTreeTuple( "LTree" )
tuple.Inputs = [ SeqL.outputLocation() ]



from PhysConf.Filters import LoKi_Filters
fltrs = LoKi_Filters(STRIP_Code = "(HLT_PASS_RE('StrippingFullDSTDiMuonJpsi2MuMuDetachedLineDecision'))" )

from Configurables import DaVinci
DaVinci().Simulation   = False
DaVinci().EvtMax = -1                        # Number of events
DaVinci().EventPreFilters = fltrs.filters('Filter')
DaVinci().UserAlgorithms = [ seq, tuple  ]
from Configurables import CondDB
#CondDB(UseOracle = True)
#importOptions("$APPCONFIGOPTS/DisableLFC.py")
#CondDB().IgnoreHeartBeat = True
DaVinci().DataType = "2012"
#DaVinci().DDDBtag   = "head-20110914"
#DaVinci().CondDBtag = "head-20111102"
DaVinci().PrintFreq = 10000
#For luminosity
#CondDB().LocalTags["LHCBCOND"] = ['lumi-20100825']
DaVinci().Lumi = True


########################################################################
MessageSvc().Format = "% F%60W%S%7W%R%T %0W%M"
from Configurables import  DaVinciInit, GetIntegratedLuminosity
# DaVinciInit().OutputLevel = 6
# MessageSvc().OutputLevel                  = 6
# GetIntegratedLuminosity().OutputLevel       = INFO
# ToolSvc().OutputLevel                     = 6
# NTupleSvc().OutputLevel                   = 6




#from GaudiConf import IOHelper
#IOHelper().inputFiles([
#'/tmp/lzhang/00020241_00001413_1.dimuon.dst'
#], clear=True)

======================= DaVinci script (Xb2JpsiXTree.py) ====
########################################################################
#
# J/psi n-tuple
#
# @author Bilas Pal
# @date 2010-11-01
######
########################################################################
from Gaudi.Configuration import *
#
# DecayTreeTuple
#
from Configurables import DecayTreeTuple, LoKi__Hybrid__TupleTool, TupleToolDecay, TupleToolTrigger, TupleToolTISTOS, TupleToolTagging
from Configurables import FitDecayTrees, TupleToolGeometry
tuple = DecayTreeTuple('LTree') 

tuple.TupleName = "mytree"

tuple.ToolList =  [
       "TupleToolGeometry",
       "TupleToolKinematic",
       "TupleToolEventInfo",
#       "TupleToolTISTOS",
       "TupleToolPid",
       "TupleToolTrackInfo",
#       "TupleToolTagging"
        ]
tistos = TupleToolTISTOS("tistos")
tistos.VerboseL0 = 1
tistos.VerboseHlt1 = 1
tistos.VerboseHlt2 = 1
tistos.TriggerList = [
                          'L0DiMuonDecision',
                             'L0HCALDecision',
                             'L0MuonDecision',
                         'L0MuonHighDecision',
               'Hlt1SingleMuonNoIPL0Decision',
                 'Hlt1DiMuonHighMassDecision',
                  'Hlt1DiMuonLowMassDecision',
               'Hlt1SingleMuonHighPTDecision',
                 'Hlt1SingleMuonNoIPDecision',
                     'Hlt1TrackAllL0Decision',
                      'Hlt1TrackMuonDecision',
               'Hlt1SingleMuonNoIPL0Decision',
                        'Hlt2DiMuonBDecision',
                         'Hlt2DiMuonDecision',                        
                      'Hlt2DiMuonDY1Decision',
                 'Hlt2DiMuonDetachedDecision',
            'Hlt2DiMuonDetachedHeavyDecision',
             'Hlt2DiMuonDetachedJPsiDecision',
                     'Hlt2DiMuonJPsiDecision',
               'Hlt2DiMuonJPsiHighPTDecision',
                    'Hlt2ExpressJPsiDecision',
            'Hlt2ExpressJPsiTagProbeDecision',
                     'Hlt2SingleMuonDecision',
               'Hlt2SingleMuonHighPTDecision',
                'Hlt2SingleMuonLowPTDecision',
                  'Hlt2Topo2BodyBBDTDecision',
                'Hlt2Topo2BodySimpleDecision',      
                  'Hlt2Topo3BodyBBDTDecision',      
                'Hlt2Topo3BodySimpleDecision',
                  'Hlt2Topo4BodyBBDTDecision',        
                'Hlt2Topo4BodySimpleDecision',      
                'Hlt2TopoMu2BodyBBDTDecision',        
                'Hlt2TopoMu3BodyBBDTDecision',      
                'Hlt2TopoMu4BodyBBDTDecision',      
                    'Hlt2TransparentDecision',                           
             'Hlt2DiMuonUnbiasedJPsiDecision'
]

tuple.addTool(TupleToolGeometry)
tuple.TupleToolGeometry.Verbose = True
#tuple.TupleToolTISTOS.UseAutomaticTriggerList = True
#tuple.addTool(TupleToolTagging)
#tuple.TupleToolTagging.Verbose = True
#from FlavourTagging.Tunings import TuneTool
#TuneTool(tuple,'Xmass_2011')

###########################################################################################################################
tuple.Decay = '[^Lambda0 -> ^p+ ^pi-]cc'
tuple.Branches = {
    "R"    :  "[^Lambda0 -> p+ pi-]cc", 
    "H1"   :  "[Lambda0 -> ^p+ pi-]cc",      
    "H2"   :  "[Lambda0 -> p+ ^pi-]cc",   
}

tuple.addTool(TupleToolDecay, name="J_psi_1S")
tuple.J_psi_1S.addTool(tistos)
tuple.J_psi_1S.ToolList+=["TupleToolTISTOS/tistos"]

tuple.ReFitPVs = True

tuple.addTool(TupleToolDecay, name="R")

LoKi_R=LoKi__Hybrid__TupleTool("LoKi_R")
LoKi_R.Variables =  {
    "WM" : "WM( 'pi+' , 'pi-')"
    }
tuple.R.addTool(LoKi_R)
tuple.R.ToolList+=["LoKi::Hybrid::TupleTool/LoKi_R"]

from Configurables import LoKi__Hybrid__EvtTupleTool as LoKiTool
tuple.addTool(LoKiTool , 'MyLoKiTool' )
tuple.ToolList += [ "LoKi::Hybrid::EvtTupleTool/MyLoKiTool" ]
tuple.MyLoKiTool.VOID_Variables = {    'nTracks' :  " CONTAINS ('Rec/Track/Best') "  ,
                                        "nLong"  :   " TrSOURCE('Rec/Track/Best', TrLONG) >> TrSIZE "
                                          }
tuple.MyLoKiTool.Preambulo = [
    "from LoKiTracks.decorators import *",
    "from LoKiCore.functions import *"
    ]


Configuring DaVinci v37r2p4 from /afs/cern.ch/user/m/mwilkins/cmtuser/DaVinci_v37r2p4
Using CMTPROJECTPATH = '/afs/cern.ch/user/m/mwilkins/cmtuser:/cvmfs/lhcb.cern.ch/lib/lhcb:/cvmfs/lhcb.cern.ch/lib/lcg/releases:/cvmfs/lhcb.cern.ch/lib/lcg/app/releases:/cvmfs/lhcb.cern.ch/lib/lcg/external'
Environment for DaVinci v37r2p4 ready.
(Compat v1r19 from /cvmfs/lhcb.cern.ch/lib/lhcb/COMPAT/COMPAT_v1r19,
 DaVinci v37r2p4 from /afs/cern.ch/user/m/mwilkins/cmtuser/DaVinci_v37r2p4)
====================================================
Finish Davinci@:    Fri May 6 16:24:09 CEST 2016
====================================================
total 52783
-rwxr--r--. 1 mwilkins z5     4047 May  6 16:14 DataXb2JpsiLK.py
-rw-r--r--. 1 mwilkins z5    51186 May  6 16:16 davinci_11_Down.log
-rw-r--r--. 1 mwilkins z5    51168 May  6 16:17 davinci_11_Up.log
-rw-r--r--. 1 mwilkins z5    51182 May  6 16:21 davinci_12_Down.log
-rw-r--r--. 1 mwilkins z5    51164 May  6 16:24 davinci_12_Up.log
-rw-r--r--. 1 mwilkins z5    24423 May  3 14:13 davinci.log
-rw-r--r--. 1 mwilkins z5     2515 Apr 30 15:17 GangaJob.py
-rw-r--r--. 1 mwilkins z5     9097 May  6 16:24 general.log
-rw-r--r--. 1 mwilkins z5  2275307 May  3 14:11 LFNs.py
-rw-r--r--. 1 mwilkins z5   434891 May  3 15:47 LHCb_Collision11_Beam3500GeVVeloClosedMagDown_RealData_Reco14_Stripping20r1_90000000_DIMUON.DST.py
-rw-r--r--. 1 mwilkins z5   308899 May  3 15:47 LHCb_Collision11_Beam3500GeVVeloClosedMagUp_RealData_Reco14_Stripping20r1_90000000_DIMUON.DST.py
-rw-r--r--. 1 mwilkins z5   786541 May  3 15:47 LHCb_Collision12_Beam4000GeVVeloClosedMagDown_RealData_Reco14_Stripping20_90000000_DIMUON.DST.py
-rw-r--r--. 1 mwilkins z5   695725 May  3 15:47 LHCb_Collision12_Beam4000GeVVeloClosedMagUp_RealData_Reco14_Stripping20_90000000_DIMUON.DST.py
-rw-r--r--. 1 mwilkins z5      147 May  3 18:00 LHCbDirac_11_Down.log
-rw-r--r--. 1 mwilkins z5      147 May  3 19:42 LHCbDirac_11_Up.log
-rw-r--r--. 1 mwilkins z5      147 May  3 22:46 LHCbDirac_12_Down.log
-rw-r--r--. 1 mwilkins z5      147 May  4 01:19 LHCbDirac_12_Up.log
-rw-r--r--. 1 mwilkins z5     2762 May  4 01:19 make_pool.log
-rw-r--r--. 1 mwilkins z5      129 May  5 14:23 pool_11_Down.py
-rw-r--r--. 1 mwilkins z5  4788915 May  3 18:00 pool_11_Down.xml
-rw-r--r--. 1 mwilkins z5      127 May  5 14:23 pool_11_Up.py
-rw-r--r--. 1 mwilkins z5  3488009 May  4 20:11 pool_11_Up.xml
-rw-r--r--. 1 mwilkins z5      129 May  5 14:23 pool_12_Down.py
-rw-r--r--. 1 mwilkins z5  8497016 May  3 22:46 pool_12_Down.xml
-rw-r--r--. 1 mwilkins z5      127 May  5 14:23 pool_12_Up.py
-rw-r--r--. 1 mwilkins z5  7600599 May  4 01:19 pool_12_Up.xml
-rw-r--r--. 1 mwilkins z5      121 May  1 15:19 pool.py
-rw-r--r--. 1 mwilkins z5 24900382 May  1 02:36 pool.xml
-rwxr-xr-x. 1 mwilkins z5     2019 May  5 19:06 script
-rwxr-xr-x. 1 mwilkins z5     1510 May  4 16:25 script_make_pool
-rwxr-xr-x. 1 mwilkins z5     1454 May  1 19:59 script_old
-rw-r--r--. 1 mwilkins z5     4146 May  5 14:31 Xb2JpsiXTree.py
